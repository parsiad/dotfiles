#!/usr/bin/env python

import argparse
import json
import sys
import urllib.request
import urllib.parse

_URL = "https://api.waqi.info/feed/{location}/?token={{ pass "api/waqi" }}"

parser = argparse.ArgumentParser(description="Get AQI from aqicn.org")
parser.add_argument("location", type=str)
args = parser.parse_args()

location = urllib.parse.quote(args.location)

url = _URL.format(location=location)

res = urllib.request.urlopen(url, timeout=1)
res = res.read()
res = json.loads(res)

if res["status"] == "error":
    print(-1)
    sys.exit(1)

aqi_str = res["data"]["aqi"]
try:
    aqi = int(aqi_str)
    print(aqi)
except ValueError:
    print("?")
